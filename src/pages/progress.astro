---
import BaseLayout from '../components/layout/BaseLayout.astro';
import Sidebar from '../components/layout/Sidebar.astro';
import Header from '../components/layout/Header.astro';
import ProgressDashboard from '../components/tracking/ProgressDashboard';
import StatisticsCharts from '../components/tracking/StatisticsCharts';

// Load flashcard counts
import swiftFundamentals from '../data/flashcards/swift-fundamentals.json';
import iosCore from '../data/flashcards/ios-core.json';
import concurrency from '../data/flashcards/concurrency.json';
import swiftui from '../data/flashcards/swiftui.json';
import systemDesign from '../data/flashcards/system-design.json';
import behavioral from '../data/flashcards/behavioral.json';

const topics = ['Swift Fundamentals', 'iOS Core', 'Concurrency', 'SwiftUI', 'System Design', 'Behavioral'];
const cardsByTopic: Record<string, number> = {
  'Swift Fundamentals': swiftFundamentals.cards.length,
  'iOS Core': iosCore.cards.length,
  'Concurrency': concurrency.cards.length,
  'SwiftUI': swiftui.cards.length,
  'System Design': systemDesign.cards.length,
  'Behavioral': behavioral.cards.length,
};

// Define 12-week curriculum
const weeks = [
  {
    month: 1,
    week: 1,
    title: "Swift Basics",
    items: [
      { id: "value-types", label: "Value vs Reference Types" },
      { id: "optionals", label: "Optionals & Unwrapping" },
      { id: "closures", label: "Closures" },
      { id: "protocols", label: "Protocols" },
    ]
  },
  {
    month: 1,
    week: 2,
    title: "Swift Advanced",
    items: [
      { id: "generics", label: "Generics" },
      { id: "error-handling", label: "Error Handling" },
      { id: "property-wrappers", label: "Property Wrappers" },
      { id: "result-builders", label: "Result Builders" },
    ]
  },
  {
    month: 1,
    week: 3,
    title: "iOS Core",
    items: [
      { id: "app-lifecycle", label: "App Lifecycle" },
      { id: "vc-lifecycle", label: "ViewController Lifecycle" },
      { id: "arc", label: "Memory Management (ARC)" },
      { id: "delegation", label: "Delegation Pattern" },
    ]
  },
  {
    month: 1,
    week: 4,
    title: "iOS Fundamentals",
    items: [
      { id: "notification-center", label: "Notification Center" },
      { id: "persistence", label: "Data Persistence" },
      { id: "keychain", label: "Keychain" },
      { id: "user-defaults", label: "UserDefaults" },
    ]
  },
  {
    month: 2,
    week: 1,
    title: "SwiftUI Basics",
    items: [
      { id: "swiftui-views", label: "View Basics" },
      { id: "state-binding", label: "@State & @Binding" },
      { id: "observable", label: "@Observable" },
      { id: "environment", label: "Environment" },
    ]
  },
  {
    month: 2,
    week: 2,
    title: "SwiftUI Advanced",
    items: [
      { id: "navigation", label: "Navigation" },
      { id: "animations", label: "Animations" },
      { id: "gestures", label: "Gestures" },
      { id: "custom-views", label: "Custom Views" },
    ]
  },
  {
    month: 2,
    week: 3,
    title: "Concurrency",
    items: [
      { id: "async-await", label: "async/await" },
      { id: "actors", label: "Actors" },
      { id: "task-groups", label: "Task Groups" },
      { id: "sendable", label: "Sendable" },
    ]
  },
  {
    month: 2,
    week: 4,
    title: "Networking & Data",
    items: [
      { id: "urlsession", label: "URLSession" },
      { id: "codable", label: "Codable" },
      { id: "combine", label: "Combine Basics" },
      { id: "swiftdata", label: "SwiftData" },
    ]
  },
  {
    month: 3,
    week: 1,
    title: "Architecture",
    items: [
      { id: "mvvm", label: "MVVM" },
      { id: "clean-arch", label: "Clean Architecture" },
      { id: "di", label: "Dependency Injection" },
      { id: "modularization", label: "Modularization" },
    ]
  },
  {
    month: 3,
    week: 2,
    title: "Testing",
    items: [
      { id: "unit-testing", label: "Unit Testing" },
      { id: "ui-testing", label: "UI Testing" },
      { id: "mocking", label: "Mocking" },
      { id: "tdd", label: "TDD" },
    ]
  },
  {
    month: 3,
    week: 3,
    title: "System Design",
    items: [
      { id: "app-architecture", label: "App Architecture" },
      { id: "offline-first", label: "Offline-First" },
      { id: "caching", label: "Caching" },
      { id: "real-time", label: "Real-time Features" },
    ]
  },
  {
    month: 3,
    week: 4,
    title: "Behavioral & Final",
    items: [
      { id: "star-method", label: "STAR Method" },
      { id: "leadership", label: "Leadership Questions" },
      { id: "mock-interviews", label: "Mock Interviews" },
      { id: "portfolio", label: "Portfolio Review" },
    ]
  },
];
---

<BaseLayout title="Progress">
  <Sidebar slot="sidebar" />
  <Header title="Progress Tracker" subtitle="Track your 12-week journey" />

  <div class="space-y-6">
    <!-- Tab Navigation -->
    <div class="flex gap-2 border-b border-[var(--color-surface-secondary)]" id="progress-tabs">
      <button
        class="tab-btn active px-4 py-2 text-body-small font-medium border-b-2 border-[var(--color-accent-orange)] text-[var(--color-accent-orange)]"
        data-tab="curriculum"
      >
        Curriculum
      </button>
      <button
        class="tab-btn px-4 py-2 text-body-small font-medium border-b-2 border-transparent text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]"
        data-tab="statistics"
      >
        Statistics
      </button>
    </div>

    <!-- Curriculum Tab -->
    <div id="curriculum-content" class="tab-content">
      <ProgressDashboard weeks={weeks} client:load />
    </div>

    <!-- Statistics Tab -->
    <div id="statistics-content" class="tab-content hidden">
      <StatisticsCharts topics={topics} cardsByTopic={cardsByTopic} client:load />
    </div>
  </div>
</BaseLayout>

<script>
  const tabs = document.querySelectorAll('#progress-tabs .tab-btn');
  const curriculumContent = document.getElementById('curriculum-content');
  const statisticsContent = document.getElementById('statistics-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => {
        t.classList.remove('active', 'border-[var(--color-accent-orange)]', 'text-[var(--color-accent-orange)]');
        t.classList.add('border-transparent', 'text-[var(--color-text-secondary)]');
      });
      tab.classList.add('active', 'border-[var(--color-accent-orange)]', 'text-[var(--color-accent-orange)]');
      tab.classList.remove('border-transparent', 'text-[var(--color-text-secondary)]');

      const tabName = tab.getAttribute('data-tab');
      if (tabName === 'curriculum') {
        curriculumContent?.classList.remove('hidden');
        statisticsContent?.classList.add('hidden');
      } else {
        curriculumContent?.classList.add('hidden');
        statisticsContent?.classList.remove('hidden');
      }
    });
  });
</script>
