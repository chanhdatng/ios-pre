---
import BaseLayout from '../../components/layout/BaseLayout.astro';
import Sidebar from '../../components/layout/Sidebar.astro';
import Header from '../../components/layout/Header.astro';
import FlashcardDeck from '../../components/interactive/FlashcardDeck';
import QuizRunner from '../../components/interactive/QuizRunner';

// Load Month 2 content
import swiftui from '../../data/flashcards/swiftui.json';
import concurrency from '../../data/flashcards/concurrency.json';
import systemDesign from '../../data/flashcards/system-design.json';
import concurrencyQuiz from '../../data/quizzes/concurrency-quiz.json';
import swiftuiQuiz from '../../data/quizzes/swiftui-quiz.json';

const swiftuiCards = swiftui.cards.map(c => ({ ...c, topic: 'SwiftUI' }));
const concurrencyCards = concurrency.cards.map(c => ({ ...c, topic: 'Concurrency' }));
const systemDesignCards = systemDesign.cards.map(c => ({ ...c, topic: 'System Design' }));
const allQuestions = [...concurrencyQuiz.questions, ...swiftuiQuiz.questions];
const basePath = import.meta.env.BASE_URL || '';
---

<BaseLayout title="Month 2">
  <Sidebar slot="sidebar" />
  <Header
    title="Month 2: Advanced Topics & System Design"
    subtitle="Weeks 5-8: Level up your skills"
  />

  <div class="space-y-8">
    <!-- Overview Cards -->
    <div class="grid md:grid-cols-3 gap-4">
      <div class="card p-5">
        <h3 class="text-headline-3 mb-3">SwiftUI</h3>
        <ul class="space-y-1.5 text-body-small text-[var(--color-text-secondary)]">
          <li>• View Lifecycle</li>
          <li>• State Management</li>
          <li>• Property Wrappers</li>
          <li>• Navigation</li>
        </ul>
        <p class="mt-3 text-caption text-[var(--color-accent-orange)]">{swiftuiCards.length} flashcards</p>
      </div>

      <div class="card p-5">
        <h3 class="text-headline-3 mb-3">Concurrency</h3>
        <ul class="space-y-1.5 text-body-small text-[var(--color-text-secondary)]">
          <li>• async/await</li>
          <li>• Actors</li>
          <li>• Task Groups</li>
          <li>• GCD & Operations</li>
        </ul>
        <p class="mt-3 text-caption text-[var(--color-accent-orange)]">{concurrencyCards.length} flashcards</p>
      </div>

      <div class="card p-5">
        <h3 class="text-headline-3 mb-3">System Design</h3>
        <ul class="space-y-1.5 text-body-small text-[var(--color-text-secondary)]">
          <li>• Mobile Architecture</li>
          <li>• Scalability</li>
          <li>• Caching Strategies</li>
          <li>• API Design</li>
        </ul>
        <p class="mt-3 text-caption text-[var(--color-accent-orange)]">{systemDesignCards.length} flashcards</p>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="flex gap-2 border-b border-[var(--color-surface-secondary)] overflow-x-auto">
      <button
        class="tab-btn active px-4 py-2 text-body-small font-medium border-b-2 border-[var(--color-accent-orange)] text-[var(--color-accent-orange)] whitespace-nowrap"
        data-tab="swiftui"
      >
        SwiftUI ({swiftuiCards.length})
      </button>
      <button
        class="tab-btn px-4 py-2 text-body-small font-medium border-b-2 border-transparent text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] whitespace-nowrap"
        data-tab="concurrency"
      >
        Concurrency ({concurrencyCards.length})
      </button>
      <button
        class="tab-btn px-4 py-2 text-body-small font-medium border-b-2 border-transparent text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] whitespace-nowrap"
        data-tab="system"
      >
        System Design ({systemDesignCards.length})
      </button>
      <button
        class="tab-btn px-4 py-2 text-body-small font-medium border-b-2 border-transparent text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] whitespace-nowrap"
        data-tab="quiz"
      >
        Quiz ({allQuestions.length})
      </button>
    </div>

    <!-- SwiftUI Flashcards -->
    <div id="swiftui-content" class="tab-content">
      <FlashcardDeck cards={swiftuiCards} client:load />
    </div>

    <!-- Concurrency Flashcards -->
    <div id="concurrency-content" class="tab-content hidden">
      <FlashcardDeck cards={concurrencyCards} client:load />
    </div>

    <!-- System Design Flashcards -->
    <div id="system-content" class="tab-content hidden">
      <FlashcardDeck cards={systemDesignCards} client:load />
    </div>

    <!-- Quiz -->
    <div id="quiz-content" class="tab-content hidden">
      <QuizRunner questions={allQuestions} client:load />
    </div>

    <!-- Quick Link -->
    <div class="text-center pt-4">
      <a href={`${basePath}/review`} class="text-[var(--color-accent-orange)] hover:underline text-body-small">
        → Go to Spaced Review for optimized learning
      </a>
    </div>
  </div>
</BaseLayout>

<script>
  const tabs = document.querySelectorAll('.tab-btn');
  const contents = ['swiftui', 'concurrency', 'system', 'quiz'];

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => {
        t.classList.remove('active', 'border-[var(--color-accent-orange)]', 'text-[var(--color-accent-orange)]');
        t.classList.add('border-transparent', 'text-[var(--color-text-secondary)]');
      });
      tab.classList.add('active', 'border-[var(--color-accent-orange)]', 'text-[var(--color-accent-orange)]');
      tab.classList.remove('border-transparent', 'text-[var(--color-text-secondary)]');

      const tabName = tab.getAttribute('data-tab');
      contents.forEach(c => {
        document.getElementById(`${c}-content`)?.classList.add('hidden');
      });
      document.getElementById(`${tabName}-content`)?.classList.remove('hidden');
    });
  });
</script>
